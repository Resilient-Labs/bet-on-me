<style>
  .profile-pic-small {
  width: 60px; 
  height:60px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;   
}

</style>

<%- include('partials/header') -%>

<div class="container-fluid team-progress-container">
  <div class="container-fluid px-5">
    <div class="row g-4">

      <!-- LEFT SIDE - Team Progress -->
      <div class="col-lg-8 col-md-7">
        <div class="card shadow-lg border-0 team-card">
          <div class="text-center card-header team-card-header">
            <h2 class="mb-0 text-dark fw-bold">
              <i class="bi me-2"></i>Team Progress
            </h2>
          </div>

          <div class="card-body p-4">

            <!-- Team Name -->
            <div class="group-name-section mb-4">
              <h3 class="fw-bold mb-0 group-name-title">
                <i class="bi me-2"></i>
                <%= cluster?.cluster_name || "No Team Yet" %>
              </h3>
            </div>

            <!-- Users and Progress -->
            <% if (members && members.length > 0) { %>
              <% members.forEach((member, index) => { %>
                <div class="card user-card mb-3">
                  <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h5 class="mb-0 fw-bold text-white">
                        <%= member.userName || member.email %>
                      </h5>
                      <span class="badge wager-badge">
                        $<%= member.wagerAmount || 0 %>
                      </span>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress progress-container">
                      <div
                        class="progress-bar progress-bar-animated progress-bar-gold"
                        role="progressbar"
                        style="width: <%= member.progress || 0 %>%"
                        aria-valuenow="<%= member.progress || 0 %>"
                        aria-valuemin="0"
                        aria-valuemax="100">
                      </div>
                    </div>
                  </div>
                </div>
              <% }) %>
            <% } else { %>
              <p class="text-muted text-center">No team members yet.</p>
            <% } %>

          </div>
        </div>
      </div>

      <!-- RIGHT SIDE - Timeline & Cash Jar -->
      <div class="col-lg-4 col-md-5">
        <div class="d-flex flex-column gap-4">

          <!-- Timeline -->
          <div class="card shadow-lg border-0 timeline-card">
            <div class=" py-4 text-center team-card-header">
              <h4 class="mb-0 text-dark fw-bold">
              Timeline
              </h4>
            </div>
            <div class="card-body text-center p-5">
              <div class="display-5 fw-bold mb-2 timeline-time">
                <i class="bi me-2"></i>
                <%= cluster?.duration || "TBD" %>
              </div>
              <h4 class="mb-0 fw-bold">Challenge Duration</h4>
            </div>
          </div>

          <!-- Cash Jar -->
          <div class="card shadow-lg border-0 cash-jar-card">
            <div class="card-header text-center cash-jar-header">
              <h4 class="mb-0 fw-bold">
                <i class="bi me-2"></i>Cash Jar
              </h4>
            </div>

            <div class="card-body text-center p-4">
              <div class="cash-card">
                <img
                  src="https://res.cloudinary.com/dphggnlyy/image/upload/v1765558274/Untitled_design_redefb.gif"
                  class="jar-img"
                  alt="Cash Jar">

                <div class="hover-jar">
                  <div class="amount-list">
                    <% members.forEach((member, index) => { %>
                      <div class="user-line" style="--delay:<%= index * 0.2 %>s;">
                          <img
                            src="<%= member.profile_image || '/images/default-avatar.png' %>"
                            alt="<%= member.userName || 'User' %> profile picture"
                            class="profile-pic-small"
                          />

                          <p>
                            <%= member.userName || member.email %>:
                            $<%= member.wagerAmount || 0 %>
                          </p>
                        </div>
                    <% }) %>
                  </div>
                </div>
              </div>

              <!-- Total Amount -->
              <div class="mt-4">
                <h2 class="display-2 fw-bold mb-2 cash-jar-total">
                  $
                  <%= members.reduce((sum, m) => sum + (m.wagerAmount || 0), 0) %>
                </h2>
                <p class="mb-0 mt-3 fs-5 fw-bold cash-jar-label">Total Pot</p>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<!-- GIF Reload Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const jarImg = document.querySelector('.jar-img');

    if (jarImg) {
      jarImg.addEventListener('mouseenter', function () {
        const src = this.src.split('?')[0];
        this.src = src + '?t=' + new Date().getTime();
      });

      jarImg.addEventListener('click', function () {
        const src = this.src.split('?')[0];
        this.src = src + '?t=' + new Date().getTime();
      });
    }
  });
</script>

<%- include('partials/footer') -%>
