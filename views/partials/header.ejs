<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bet On Me</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/imgs/BETonMe.jpg" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link href="/css/headers.css" rel="stylesheet" />
  <link href="/css/heroes.css" rel="stylesheet" />
  <!-- Keep styles.css last, Add yours on the top ⬆︎⬆︎⬆︎⬆︎ -->
  <link rel="stylesheet" href="/css/style.css" />
  <script src="/js/main.js" defer></script>
</head>

<body>
  <header class="custom-header">
    <nav class="navbar navbar-expand-lg">
      <div class="container d-flex align-items-center justify-content-between">

        <!-- Logo -->
        <a href="/home" class="navbar-brand d-flex align-items-center">
          <div class="logo-container">
            <img class="bi me-2 header-logo" role="img" aria-label="Bootstrap" src="/imgs/BETonMe-noBg.png">
          </div>
        </a>

        <!-- Mobile burger + logout: only for logged-in users -->
        <% if (user) { %>
          <div class="d-flex d-lg-none align-items-center gap-2 ms-auto">
            <!-- Burger -->
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#mainNavbar"
              aria-controls="mainNavbar"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Logout button -->
            <a href="/logout" class="btn btn-warning btn-hover signup">Logout</a>
          </div>
        <% } %>

        <!-- Collapsible menu: only for logged-in users -->
        <% if (user) { %>
          <div class="collapse navbar-collapse" id="mainNavbar">
            <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-3">

                <%
                  const safeGoals = typeof goals !== 'undefined' ? goals : null;
                  const canAccessTeamPage = Boolean(safeGoals?.id && safeGoals?.wagerPaid);
                %>
                <li class="nav-item">
                  <a
                    id="<%= canAccessTeamPage ? '' : 'team-page-disable' %>"
                    class="nav-link"
                    href="<%= canAccessTeamPage ? '/teamPage' : '#' %>"
                    title="<%= canAccessTeamPage ? '' : 'Add a wager to your goal before accessing your Group Page' %>"
                    <%= canAccessTeamPage ? '' : 'onclick="event.preventDefault()"' %>
                  >
                    My Group
                  </a>
                </li>

                <li class="nav-item">
                  <a href="/userGoal" class="nav-link">My Goal</a>
                </li>

              <li class="nav-item d-lg-none">
                <a href="/profile" class="nav-link">Profile</a>
              </li>
            </ul>
          </div>
        <% } %>

        <!-- Desktop-only profile + logout for logged-in users -->
        <% if (user) { %>
          <div class="d-none d-lg-flex align-items-center gap-3">
            <a href="/profile" class="profile-bubble" id="profile-nav">
              <img
                src="<%= user.profile_image || 'https://via.placeholder.com/50' %>"
                class="rounded-circle"
                style="width:50px;height:50px;object-fit:cover;border:2px solid;"
              />
            </a>
            <a href="/logout" class="btn btn-warning btn-hover signup">Logout</a>
          </div>
        <% } %>

        <% if (!user) { %>
          <div class="d-flex align-items-center gap-2 ms-auto">
            <button type="button" class="btn btn-warning btn-hover">
              <a href="#" class="login" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a>
            </button>
            <button type="button" class="btn btn-warning btn-hover">
              <a href="#" class="signup" data-bs-toggle="modal" data-bs-target="#signupModal">Signup</a>
            </button>
          </div>
        <% } %>

      </div>
    </nav>
  </header>

  <!-- modals -->
  <%- include('../partials/loginModal') %>
    <%- include('../partials/signupModal') %>
      <%- include('../partials/resetModal') %>